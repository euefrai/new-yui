<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
  <title>Yui</title>
  <link rel="stylesheet" href="/static/style.css?v={{ static_version }}" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@11.9.0/styles/github-dark.min.css" />
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="https://cdn.jsdelivr.net/npm/highlight.js@11.9.0"></script>
</head>
<body>

  <div id="loginScreen" class="loginScreen">
    <div class="loginCard">
      <h1 class="loginLogo">
        <img src="/static/yui-icon.png" alt="Yui" class="yuiLogoImg" />
      </h1>
      <p class="loginSub">Entre para acessar seus chats</p>
      <form id="loginForm">
        <input type="email" id="loginEmail" placeholder="E-mail" required />
        <input type="password" id="loginPassword" placeholder="Senha" required />
        <button type="submit">Entrar</button>
      </form>
      <p class="loginHint">N√£o tem conta? <a href="#" id="toggleSignUp">Cadastrar</a></p>
      <p id="loginError" class="loginError"></p>
    </div>
  </div>

  <div id="appScreen" class="app" style="display: none;">
    <div class="appContent" id="appContent" data-model="yui">
    <aside class="sidebar" id="sidebar">
      <div class="sidebarHeader">
        <div class="logo" id="sidebarLogo">
          <img src="/static/yui-icon.png" alt="Yui" class="yuiLogoImg" id="sidebarAvatar" />
        </div>
        <button type="button" id="sidebarToggle" class="sidebarToggle" title="Recolher/Expandir sidebar" aria-label="Recolher sidebar">
          <span class="sidebarToggleIcon">‚óÄ</span>
        </button>
      </div>
      <div class="sidebarMain">
        <button type="button" id="novoChat" class="btnNovoChat">
          <span class="btnIcon">+</span>
          <span class="btnLabel">Novo chat</span>
        </button>
        <button type="button" id="toggleWorkspace" class="btnToggleWorkspace" title="Abrir/fechar Editor (Ctrl+L)">
          <span class="btnIcon">&#60;/&#62;</span>
          <span class="btnLabel">Editor</span>
        </button>
        <button type="button" id="clearChat" class="btnClearChat" title="Limpar mem√≥ria da sess√£o">
          <span class="btnIcon">üóë</span>
          <span class="btnLabel">Excluir Chat</span>
        </button>
        <button type="button" id="refreshPage" class="btnRefreshPage" title="Atualizar a p√°gina agora">
          <span class="btnIcon">‚Üª</span>
          <span class="btnLabel">Atualizar Tela</span>
        </button>
        <button type="button" id="btnDeployYui" class="btnDeployYui" title="Commit e push no reposit√≥rio Zeabur">
          <span class="btnIcon">üöÄ</span>
          <span class="btnLabel">Deploy via Yui</span>
        </button>
        <div id="listaChats" class="listaChats"></div>
        <div class="sidebarTabContainer">
          <div class="sidebarTabs">
            <button type="button" class="sidebarTab active" data-sidebar-tab="tarefas" title="Tarefas e Miss√£o">
              <span class="sidebarTabIcon">‚úì</span>
              <span class="sidebarTabLabel">Tarefas</span>
            </button>
            <button type="button" class="sidebarTab" data-sidebar-tab="sistema" title="Sistema e Telemetria">
              <span class="sidebarTabIcon">‚öô</span>
              <span class="sidebarTabLabel">Sistema</span>
            </button>
          </div>
          <div class="sidebarTabContentWrap">
            <div class="sidebarTabContent active" id="sidebarTabTarefas">
              <div class="tasksPanel" id="tasksPanel" title="Afazeres ‚Äî Heathcliff pode criar tarefas automaticamente">
                <div class="tasksPanelHeader">
                  <span class="tasksPanelTitle">Afazeres</span>
                  <button type="button" id="tasksAddBtn" class="tasksAddBtn" title="Nova tarefa">+</button>
                </div>
                <ul class="tasksList" id="tasksList"></ul>
                <input type="text" id="tasksInput" class="tasksInput" placeholder="Nova tarefa..." style="display:none" />
              </div>
              <div class="missionPanel" id="missionPanel" title="Miss√£o ativa ‚Äî Project Brain" style="display:none">
                <div class="missionPanelHeader">
                  <span class="missionPanelTitle">‚ú® Miss√£o Ativa</span>
                </div>
                <div class="missionPanelContent" id="missionPanelContent">
                  <div class="missionGoal" id="missionGoal">‚Äî</div>
                  <div class="missionProgressWrap">
                    <div class="missionProgressBar" id="missionProgressBar">
                      <div class="missionProgressFill" id="missionProgressFill"></div>
                    </div>
                    <span class="missionProgressLabel" id="missionProgressLabel">0%</span>
                  </div>
                  <div class="missionCurrentTask" id="missionCurrentTask"></div>
                </div>
              </div>
            </div>
            <div class="sidebarTabContent" id="sidebarTabSistema">
              <div class="activityPanel" id="activityPanel" title="System Activity ‚Äî Observability">
                <div class="activityTitle">‚öôÔ∏è System Activity</div>
                <div class="skillsSection" id="skillsSection">
                  <div class="skillsSectionTitle">üß† Skills Ativas</div>
                  <ul class="skillsList" id="skillsList"></ul>
                </div>
                <ul class="activityList" id="activityList"></ul>
                <div class="activityTimeline" id="activityTimeline">
                  <div class="activityTimelineTitle">üß† Execution Timeline</div>
                  <ul class="activityTimelineList" id="activityTimelineList"></ul>
                </div>
              </div>
              <div class="cognitivePanel" id="cognitivePanel" title="Cognitive Loop ‚Äî Observability">
                <div class="cognitiveTitle">üß† Cognitive Status</div>
                <div class="cognitiveRow">
                  <span class="cognitiveLabel">Planner Confidence</span>
                  <span class="cognitiveValue" id="cognitiveConfidence">‚Äî</span>
                </div>
                <div class="cognitiveRow">
                  <span class="cognitiveLabel">Last Action Score</span>
                  <span class="cognitiveValue" id="cognitiveScore">‚Äî</span>
                </div>
                <div class="cognitiveRow">
                  <span class="cognitiveLabel">RAM Impact</span>
                  <span class="cognitiveValue" id="cognitiveRam">‚Äî</span>
                </div>
              </div>
              <div class="telemetryPanel" id="telemetryPanel" title="Custo acumulado do dia">
                <div class="telemetryTitle">Telemetria</div>
                <div class="telemetryRow">
                  <span class="telemetryLabel">Custo hoje</span>
                  <span class="telemetryValue" id="telemetryCost">‚Äî</span>
                </div>
                <div class="telemetryRow">
                  <span class="telemetryLabel">Requisi√ß√µes</span>
                  <span class="telemetryValue" id="telemetryRequests">‚Äî</span>
                </div>
                <div class="telemetryRow">
                  <span class="telemetryLabel">Custo da √∫ltima resposta</span>
                  <span class="telemetryValue" id="telemetryLastResponse">‚Äî</span>
                </div>
                <div class="telemetryRow">
                  <span class="telemetryLabel">Tokens (entrada/sa√≠da)</span>
                  <span class="telemetryValue" id="telemetryTokens">‚Äî</span>
                </div>
                <div class="telemetryRow">
                  <span class="telemetryLabel">Escrita em disco</span>
                  <span class="telemetryValue" id="telemetryDiskWrites">‚Äî</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="userFooter">
        <div class="userAvatar" id="userAvatar"></div>
        <span id="userName">Usu√°rio</span>
        <button type="button" id="btnSair" class="btnSair">Sair</button>
      </div>
    </aside>

    <div class="mainSplit" id="mainSplit">
        
        <main class="chatArea" id="chatArea">
          <div class="chatContainer">
            <div id="chat" class="chatMessages"></div>
            
            <div class="modelSwitcherWrap">
              <select id="modelSwitcher" class="modelSwitcher">
                <option value="auto">Auto ‚Äî Arbiter decide</option>
                <option value="yui">Yui ‚Äî Modo Padr√£o</option>
                <option value="heathcliff">Heathcliff ‚Äî Modo Engenheiro</option>
              </select>
            </div>

            <div class="inputArea" id="inputArea">
              <label class="btnAnexo">
                <span class="btnAnexoIcon">&#128206;</span>
                <input type="file" id="fileInput" hidden />
              </label>
              <input id="msg" type="text" placeholder="Digite sua mensagem..." autocomplete="off" />
              <button type="button" id="btnEnviar">Enviar</button>
            </div>
          </div>
        </main>

        <div class="mainSplitResizer" id="mainSplitResizer"></div>

        <aside class="workspacePanel" id="workspacePanel">
          <div class="workspaceHeader">
            <span class="workspaceTitle">Workspace</span>
            <div class="workspaceActions">
              <input type="file" id="workspaceImportInput" webkitdirectory directory multiple hidden />
              <button type="button" id="workspaceImport" class="workspaceBtn" title="Importar pasta do computador">üìÇ Importar</button>
              <button type="button" id="workspaceLoadSandbox" class="workspaceBtn" title="Carregar projeto do Sandbox">üìÅ Carregar Sandbox</button>
              <button type="button" id="workspaceRun" class="workspaceBtn workspaceBtnPlay">‚ñ∂ Executar</button>
              <button type="button" id="workspaceSyncSandbox" class="workspaceBtn">Salvar</button>
              <button type="button" id="workspaceExport" class="workspaceBtn">Compactar</button>
            </div>
          </div>

          <div class="workspaceBody">
            <div class="workspaceMainRow">
              <div class="fileTreeSidebar" id="fileTreeSidebar">
                <div id="fileTreeList"></div>
                <div id="fileTreeEmpty" class="fileTreeEmpty" style="display:none">Nenhum arquivo. Importe uma pasta ou carregue o Sandbox.</div>
              </div>
              <div class="workspaceEditorColumn">
                <div class="workspaceTabs" id="workspaceTabs">
                  <button type="button" class="workspaceTab active" data-tab="editor">Editor</button>
                  <button type="button" class="workspaceTab" data-tab="preview">Preview</button>
                </div>
                <div class="workspaceTabContent" id="workspaceTabEditor">
                  <div id="monacoContainer" class="monacoContainer"></div>
                </div>
                <div class="workspaceTabContent workspacePreviewWrap" id="workspaceTabPreview" style="display:none">
                  <div id="workspacePreviewEmpty" class="workspacePreviewEmpty">Abra um arquivo HTML para visualizar o preview.</div>
                  <iframe id="workspacePreviewFrame" class="workspacePreviewFrame"></iframe>
                </div>
              </div>
            </div>
            <div class="workspaceTerminalWrap" id="workspaceTerminalWrap">
              <div class="workspaceTerminalHeader">
                <span>Terminal</span>
                <div class="workspaceTerminalHeaderActions">
                  <button type="button" id="workspaceTerminalExpand" class="workspaceTerminalToggle" title="Ampliar terminal">‚§¢</button>
                  <button type="button" id="workspaceTerminalToggle" class="workspaceTerminalToggle" title="Expandir/Recolher">‚ñº</button>
                </div>
              </div>
              <div id="workspaceTerminal" class="workspaceTerminal" tabindex="0" title="Clique para focar e digitar comandos"></div>
            </div>
          </div>
        </aside>
      </div>
    </div>
  </div>

  <script>
    window.SUPABASE_URL = "{{ supabase_url or '' }}";
    window.SUPABASE_KEY = "{{ supabase_key or '' }}";
    window.loadWorkspaceLibs = function (cb) {
      if (window._workspaceLibsLoaded) { if (cb) cb(); return; }
      var pending = 3;
      function done() { if (--pending === 0) { window._workspaceLibsLoaded = true; if (cb) cb(); } }
      var l = document.createElement("link"); l.rel = "stylesheet"; l.href = "https://cdn.jsdelivr.net/npm/xterm@5.3.0/css/xterm.min.css"; document.head.appendChild(l);
      ["https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js","https://cdn.jsdelivr.net/npm/xterm@5.3.0/lib/xterm.min.js","https://cdn.jsdelivr.net/npm/xterm-addon-fit@0.8.0/lib/xterm-addon-fit.min.js"].forEach(function(url){
        var s = document.createElement("script"); s.src = url; s.onload = done; document.body.appendChild(s);
      });
    };
  </script>

  <script src="/static/app.js?v={{ static_version }}"></script>
  <script src="/static/chat.js?v={{ static_version }}"></script>
  <script src="/static/editor.js?v={{ static_version }}"></script>
  <script src="/static/workspace-project.js?v={{ static_version }}"></script>
  <script src="/static/workspace-terminal.js?v={{ static_version }}"></script>
</body>
</html>